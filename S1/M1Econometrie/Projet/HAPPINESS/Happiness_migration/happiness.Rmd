---
title: "Mesure du bonheur"
author:
- name: Loïc Rakotoson
- name: Dylan Monfret
output:
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    number_sections: yes
    theme: spacelab
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.4
  kernelspec:
    display_name: R
    language: R
    name: ir
---

<!-- #region -->
# Introduction
Nous basons notre étude sur le rapport de publié par le [World Happiness Report](https://worldhappiness.report) sur le bonheur.  
Les scores obtenus sont obtenus par les enquêtes de **Gallup**, et nous disposons directement de la moyenne pour chaque pays pour chaque année.

- `Life_Ladder`: La **variable à expliquer**. Un score obtenu en demandant aux répondants d'évaluer leur vie sur une échelle de 0 à 10, où 0 est la pire vie possible et 10 l'extrême opposé.
- `Foreign_born`: La note moyenne donnée par les personnes qui ne sont pas originaires du pays.
- `Locally_born`: La note moyenne donnée par les personnes de souche.
- `Whisker.high` et `low`: Les notes maximale et minimale.



Nous utilisons les données à jour des 4 dernières années pour construire nos données pour l'analyse, ils s'agiront de nos **variables exogènes**. Nos données brutes proviennent de:

- **Banque Mondiale**:
    - `GDP_PPP`: Moyenne du PIB par habitant à parité de pouvoir d'achat (PPA) corrigée en dollars internationaux constants de 2011, entre 2015 et 2018 *(2013 - 2016 dans le rapport du WHR)*.
    - `GINI 02-18`: Moyenne de l'indice de GINI de 2002 à 2018 *(2000 - 2016 dans le rapport du WHR)*.
- **Organisation Mondiale de la Santé**:  
    - `HALE_birth`: Espérance de vie en bonne santé à la naissance pour chaque pays, données de l'OMS de 2012. Les données manquantes ont été complétées par les données de la banque mondiale pour la même année.  
- **Gallup World Poll**:  
    - `Social_support`: Moyenne nationale des réponses binaires (0 ou 1) à la question "Si vous aviez des problèmes, avez-vous des parents ou des amis sur lesquels vous pouvez compter pour vous aider quand vous en avez besoin ou non ?"  
    - `Freedom`: Moyenne nationale des réponses binaires à la question "Êtes-vous satisfait ou insatisfait de votre liberté de choisir ce que vous faites de votre vie ?  
    - `Generosity`: Résidu de la régression de la moyenne nationale des réponses à la question " Avez-vous donné de l'argent à un organisme de bienfaisance au cours du dernier mois ?" sur le PIB par habitant.  
    - `Corruption`: Moyenne des réponses binaires à deux questions:  
        - "La corruption est-elle répandue dans tout le gouvernement ou non ?"  
        - "La corruption est-elle répandue dans les entreprises ou non ?"  
    - `Positive_affect` ( resp. `Negative_affect`): Moyenne des mesures de l'effet des jours précédents l'enquête pour le bonheur, le rire et le plaisir (resp. l'inquiétude, la tristesse et la colère).  
    - `Confidence_government`: Moyenne nationale des réponses binaires à la question "Faîtes-vous confiance en votre gouvernement ?"  
    - `GINI_household_income_Gallup`: Mesure de l'indice de GINI pour les ménages du pays en 2017  
    - `Trust_People_Gallup`: Moyenne nationale des réponses binaires à la question "Faîtes-vous confiance à un inconnu ?"  
- **European Social Survey**:  
    - `Democratic_Quality`: Moyenne nationale de la mesure de la qualité de la démocratie sur une échelle de 0 à 10, ramenée à une échelle de -5 à +5  
    - `Delivery_Quality`: Moyenne nationale de la mesure de la prestation du gouvernement sur une échelle de 0 à 10, ramenée à une échelle de -5 à +5  
- **World Value Survey**:  
    - `Trust_people_WVS` pour `05_09` et `10_14`: Moyenne nationale des réponses binaires en 2005-2009, puis en 2010-2014, à la question "Faîtes-vous confiance à un inconnu ?"  
- **World Happiness Report**:  
    - `Region`: Régions utilisées par WHR pour leur analyse

---
Libraries utilisées
```
PerformanceAnalytics
ggplot2
gridExtra
reshape
AER
```
<!-- #endregion -->

```{r message=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(PerformanceAnalytics, ggplot2, gridExtra, reshape, AER)
```

```{r}
brut <- read.csv("brut.csv",
                 sep = ";",
                 header = T,
                 encoding = "UTF-8",
                 dec = ","
                )

region <- read.csv("region.csv",
                   sep = ";",
                   header = T,
                   encoding = "UTF-8"
                  )

citizenship <- read.csv("locally_foreign.csv",
                        sep = ";",
                        header = T,
                        encoding = "UTF-8",
                        dec = ","
                       )
```

# Statistique descriptive
Dans notre table d'analyse, nous avons pour chaque individu (Pays), ses statistiques obtenues grâce au prétraitement expliqué précédemment.  
Dans cette section, nous analyserons la distribution des variables au sein des individus, la corrélation entre elles.

```{r}
data <- merge(region,
              merge(citizenship,
                    aggregate(brut[, 3:19], list(brut$Country), mean, na.rm = T),
                    by.x = "Country", by.y = "Group.1"),
              by = "Country")

head(data)
```

## Distribution du score
Visualisons les **distributions mondiale et régionales** de l'évaluation `Life_Ladder` moyenne des 4 dernières années.  
En effet, le score peut aussi dépendre de la région du monde où les répondants vivent. On remarque que les scores sont tous supérieurs à 5 en Amérique latine, en Europe Occidentale.

```{r fig.height=12, fig.width=12, message=FALSE, warning=FALSE}
world <- ggplot(data) + aes(x = Life_Ladder) + geom_histogram(color = "red", fill = "orange", 
    alpha = 0.2) + scale_x_continuous(name = "World", limits = c(0, 10)) + ylab("")

region <- vector("list", length = 10)
for (i in 1:length(levels(data$Region))) {
    region[[i]] <- ggplot(data[data$Region == levels(data$Region)[i], ]) +
                    aes(x = Life_Ladder) + 
                    geom_histogram(color = "red", fill = "orange", alpha = 0.2) +
                    scale_x_continuous(name = levels(data$Region)[i],
                                       limits = c(0, 10)) + ylab("")
}

grid.arrange(world, region[[1]],
             region[[2]], region[[3]], region[[4]],
             region[[5]], region[[6]], region[[7]],
             region[[8]], region[[9]], region[[10]],
             ncol = 3, nrow = 4,
             layout_matrix = matrix(c(rep(1,2),2:11), ncol = 3, byrow = T)
             )
```

Visualisons la **distribution en fonction de l'origine** de `Life_Ladder`.  
La répartition des scores est confondues entre les personnes de souche `Locally_born` et celles non originaires du pays `Foreign_born`. Dans la suite, nous considérerons uniquement `Life_Ladder` donc.

```{r fig.width=12, message=FALSE, warning=FALSE}
ggplot(melt(data[,c(3,6)]), aes(x = value)) +
    geom_histogram(aes(color = variable, fill = variable),
                   position = "identity",
                   bins = 30, alpha = 0.4) +
    scale_color_manual(values = c("red", "blue4")) +
    scale_fill_manual(values = c("orange", "deepskyblue")) +
    scale_x_continuous(name = "Life Ladder",
                       limits = c(0, 10)) + ylab("") +
    theme(plot.title = element_text(hjust = 0.5)) +
    labs(title = "Distribution du score\nen fonction de l'origine")
```

## Matrice de corrélation des variables
Visualisons la **matrice de corrélation** entre les variables.

La distribution de chacun des variables figure sur la diagonale. Les nuages de points avec les courbes de tendance, sous la diagonale. Les coefficients de corrélation de Pearson avec les niveaux de significativité, sur la partie supérieure.  
Signif. codes:  0 '\*\*\*' 0.001 '\*\*' 0.01 '\*' 0.05 '.' 0.1 ' ' 1

- Les 8 premières variables endogènes sont significativement corrélées avec `Life_Ladder`.
- `Confidence_government` n'est pas corrélée avec la variable à expliquer, toutefois elle est significativement corrélée avec `Freedom` et `Corruption`.
- Le nuage de points de `Democratic_quality` et `Delivery_quality` démontre un accroissement simultané des deux paramètres et donc d'une forte corrélation positive entre elles. De plus, elles sont significativement corrélées avec la variables à expliquer et les 8 premières variables endogènes.
- Les deux variables de `GINI` possèdent sensiblement la même distribution et sont significativement corrélées. `GINI_household` est la plus corrélée à la variable à expliquer.
- Les trois variables de `Trust_People` sont distribuées de la même manière et sont fortement corrélées entre elles. `Trust_People_WVS_05_09` est la plus corrélée à `Life_Ladder`.

```{r fig.height=12, fig.width=12}
chart.Correlation(data[,7:length(data)],
                  histogram = T)
```

## Répartition des variables de sondage
Visualisons la répartition des variables explicatives obtenues par sondage.  
Les interprétations de la matrice de corrélation s'appliquent à cette représentation.  
Les variables `Democratic_Quality` et `Delivery_Quality` sont sensiblement réparties de la même manière.  
Lors de l'optimisation de nos modèles, nous choisirons parmis les variables semblablement réparties (`GINI` et `Trust`), celles qui sont les plus corrélées à `Life_Ladder`.

```{r fig.height=8, fig.width=12, message=FALSE, warning=FALSE}
ggplot(melt(data[, c(9, 11:length(data))]),
       aes(x = variable, y = value)) +
    geom_boxplot(color = "red", fill = "orange", alpha = 0.2) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          plot.title = element_text(hjust = 0.5)) +
    labs(title = "Distribution des variables explicatives de sondage",
         x = "", y = "")
```

## Nuage de points et tendance
Dans la matrice de corrélation précédente, on remarque une tendance exponentielle entre `Life_Ladder`~`GDP_PPP`.  
L'utilisation du logarithme naturel de `GDP_PPP` correspond beaucoup mieux aux données de `Life_Ladder`.

```{r fig.width=12, message=FALSE, warning=FALSE}
ggplot(data) +
    aes(x = log(GDP_PPP), y = Life_Ladder) +
    geom_point(color = "red") +
    theme(plot.title = element_text(hjust = 0.5)) +
    labs(title = "Score en fonction du\nlogarithme du PIB par habitant")
```

# Modélisation
## Modèle 1: modèle linéaire général
Nous effectuons une régression sur un modèle linéaire sur toutes nos variables explicatives de façon brute.
$$\textrm{Life_Ladder} \sim \textrm{GDP_PPP} + \textrm{Social_support} + \textrm{HALE_birth} + ... + \textrm{Trust_people_WVS_10_14}$$

```{r}
mod1 <- lm(Life_Ladder~., data = data[,7:length(data)])
summary(mod1)
```

Ce modèle est globalement valide mais aucun coefficient n'est significatif comme attendu.  
Il faut noter que les variables `Trust` possèdent un nombre important de valeurs manquantes. Nous ne les garderons pas.  
En s'appuyant sur l'analyse descriptive précédente, entre `GINI 2000-16` et `GINI household` fortement corrélées nous garderon la dernière car mieux corrélée à la variable à expliquer.

## Modèle 2: modèle sur les qualités et GINI
L'analyse descriptive a conclut que `Democratic_quality` et `Delivery_quality` sont corrélées entre elles et significativement corrélées aux 8 premières variables endogènes.  
On pose comme nouveau modèle `Life_Ladder` expliquée par ces deux variables et l'indice de `GINI` gardée.
$$\textrm{Life_Ladder} \sim \textrm{Democratic_Quality} + \textrm{Delivery_Quality} + \textrm{GINI_household}$$

```{r}
mod2 <- lm(Life_Ladder ~ Democratic_Quality + Delivery_Quality + GINI_household,
           data = data)
summary(mod2)
```

Ce 2e modèle est globalement valide et toutes les varibles sont significatives à l'exception de `Democratic_Quality`, avec un R2 ajusté de 0.65.  
En effet, la part de variance expliquée part ce modèle est assez faible.

## Modèle 3: modèle sur les 8 variables et GINI
Ajustons sur les 8 premières variables exogènes et `GINI`.  
En se basant sur l'analyse descriptive, nous utiliserons le logarithme naturel du PIB par habitant.  
`Freedom` et `Corruption` seront utilisées au lieu de `Confidence_government`.
$$\textrm{Life_Ladder} \sim log(\textrm{GDP_PPP}) + \textrm{Social_support} + \textrm{HALE_birth} + \textrm{Freedom} + \\ \textrm{Generosity} + \textrm{Corruption} + \textrm{Positive_affect} + \textrm{Negative_affect} + \textrm{GINI_household}$$

```{r}
mod3 <- lm(Life_Ladder ~ log(GDP_PPP) + Social_support + HALE_birth + Freedom + Generosity + Corruption + 
    Positive_affect + Negative_affect + GINI_household,
           data = data)
summary(mod3)
```

Ce 3e modèle est globalement significatif avec un R2 ajusté de 0.90. La part de variance expliquée est nettement plus élevée par rapport au modèle précédent.  
`Freedom` et `Corruption` ne sont pas significatives au niveau $\alpha$ = 10%. La corruption dans les institutions et la liberté de choix de vie n'influent que très peu sur le bonheur subjectif.  
Le `Negative_affect` n'est pas significative non plus, l'impact de la tristesse, de l'inquiétude et de la colère est éphémère sur le bonheur subjectif.

## Modèle 4: optimisation sur les variables significatives
Nous retirons les variables qui ne sont pas significatives au niveau $\alpha$ = 10% dans le 3e modèle.
$$\textrm{Life_Ladder} \sim log(\textrm{GDP_PPP}) + \textrm{Social_support} +\\ \textrm{HALE_birth} + \textrm{Generosity} + \textrm{Positive_affect} + \textrm{GINI_household}$$

```{r}
mod4 <- lm(Life_Ladder ~ log(GDP_PPP) + Social_support + HALE_birth + Generosity +
           Positive_affect + GINI_household,
           data = data)
summary(mod4)
```

Notre modèle optimisé est donc naturellement valide. Toutes les variables sont significatives au niveau $\alpha$ = 5%.  
La déletion des 3 variables non significatives n'a pas baissé le R2, qui est toujours de 0.90

## Modèle 5: endogénéité de GDP
Cette forte valeur de R2 peut cacher un problème d'endogénéité.  
En effet, la qualité du gouvernement et la corruption minent souvent une économie et touche directement le PIB par habitant qui, quand il est faible, explique un score élevé dans les effets négatifs.  
Nous prendrons donc `Delivery_Quality`, `Corruption` et `Negative_affect` comme instruments.

```{r}
iv <- ivreg(Life_Ladder ~ log(GDP_PPP) + Social_support + HALE_birth + Generosity + 
    Positive_affect + GINI_household | . - log(GDP_PPP) + Delivery_Quality + Corruption + 
    Negative_affect, data = data)
summary(iv, diagnostics = T)
```

- `Weak instruments`: on rejette $H_0$: "*les instruments sont tous nuls*", il existe au moins un instrument fort
- `Wu-Hausman`: on rejette au niveau $\alpha$=10% $H_0$ qui suppose que `log(GDP_PPP)` n'est pas corrélée avec le terme d'erreur, ce qui indique qu'elle est marginalement endogène.
- `Sargan`: on ne rejette pas l'hypothèse nulle, ce qui signifie que les instruments supplémentaires sont valides (ne sont pas corrélés avec le terme d'erreur).

Dans ce modèle, le PIB par habitant est marginalement endogène. En effet, la variable est dépend des instruments qui étaient capturés par $\varepsilon$. `Social_support` et `HALE_birth` ne sont plus significatives, et le R2 n'a que peu diminué.  
Comme à $\alpha$ 0.05 il n'y a pas de problème d'endogénéité, on garde alors l'estimation des MCO du modèle 4 qui est meilleure.

# Conclusion

___
# Bibliographie
